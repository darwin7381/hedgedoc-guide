---
title: n8n + HedgeDoc Redirect å•é¡Œå®Œæ•´è§£æ±ºæ–¹æ¡ˆ
---

# n8n + HedgeDoc Redirect å•é¡Œå®Œæ•´è§£æ±ºæ–¹æ¡ˆ

**å•é¡Œç‹€æ…‹**ï¼šâœ… å·²è§£æ±º  
**å½±éŸ¿ç¯„åœ**ï¼šæ‰€æœ‰ä½¿ç”¨ n8n èª¿ç”¨ HedgeDoc API çš„å ´æ™¯  
**è§£æ±ºæ—¥æœŸ**ï¼š2025-11-09

---

## ğŸ“‹ å•é¡Œæ‘˜è¦

åœ¨ n8n ä¸­èª¿ç”¨ HedgeDoc APIï¼ˆé€é Token Manager Gatewayï¼‰å‰µå»ºç­†è¨˜æ™‚ï¼Œè¿”å›çš„ä¸æ˜¯é æœŸçš„ 302 redirectï¼Œè€Œæ˜¯ HTML é é¢å…§å®¹æˆ–éŒ¯èª¤è¨Šæ¯ã€‚

---

## ğŸ› å•é¡Œç¾è±¡

### ç¾è±¡ 1ï¼šè¿”å› HTML é é¢

**ç—‡ç‹€**ï¼š
```json
{
  "statusCode": 200,
  "data": "<!DOCTYPE html>\n<html>\n<head>\n<title>HedgeDoc</title>..."
}
```

**é æœŸçµæœ**ï¼š
```json
{
  "statusCode": 302,
  "headers": {
    "location": "https://api-gateway.cryptoxlab.workers.dev/api/hedgedoc/abc123"
  }
}
```

### ç¾è±¡ 2ï¼šè¿”å›éŒ¯èª¤è¨Šæ¯

**ç—‡ç‹€**ï¼š
```
NodeApiError: 302 - "Found. Redirecting to https://md.blocktempo.ai/..."
Problem in node 'HTTP Request'
```

**æˆªåœ–è­‰æ“š**ï¼š
- éŒ¯èª¤é¡¯ç¤º `302 - "Found. Redirecting to ..."`
- n8n å°‡ 302 è¦–ç‚ºéŒ¯èª¤è€Œéæ­£å¸¸éŸ¿æ‡‰

---

## ğŸ” æ ¹æœ¬åŸå› åˆ†æ

### å•é¡Œå±¤ç´š

é€™å€‹å•é¡Œæ¶‰åŠ**å…©å€‹ç¨ç«‹çš„å±¤ç´š**ï¼š

#### å±¤ç´š 1ï¼šGateway Workerï¼ˆå·²è§£æ±ºï¼‰

**å•é¡Œ**ï¼š
- Cloudflare Worker ç„¡æ³•è™•ç† `POST + Request Body + 302 Redirect`
- åŸå› ï¼š`request.body` æ˜¯ ReadableStreamï¼ˆå–®æ¬¡ä½¿ç”¨ï¼‰
- Fetch API é è¨­è·Ÿéš¨ redirectï¼Œä½† stream ç„¡æ³•é‡æ–°ç™¼é€

**è§£æ±ºæ–¹æ¡ˆ**ï¼ˆåœ¨ Worker ä»£ç¢¼ä¸­ï¼‰ï¼š
```javascript
// å°‡ body è½‰æˆå¯é‡è¤‡ä½¿ç”¨çš„ buffer
const requestInit = {
  method: request.method,
  headers: request.headers,
  redirect: 'manual',  // ä¸è‡ªå‹•è·Ÿéš¨ redirect
  body: request.body ? await request.arrayBuffer() : undefined
};
```

**ç‹€æ…‹**ï¼šâœ… å·²ç”± Core Team åœ¨ Gateway Worker ä¸­ä¿®å¾©

#### å±¤ç´š 2ï¼šn8n å®¢æˆ¶ç«¯ï¼ˆéœ€è¦ç”¨æˆ¶è¨­ç½®ï¼‰

**å•é¡Œ**ï¼š
- n8n HTTP Request ç¯€é»é è¨­æœƒè‡ªå‹•è·Ÿéš¨ redirect
- n8n å°‡é 2xx ç‹€æ…‹ç¢¼è¦–ç‚ºéŒ¯èª¤

**è¡Œç‚ºå°æ¯”**ï¼š

| å·¥å…· | é è¨­è¡Œç‚º | çµæœ |
|------|---------|------|
| `curl -i` | é¡¯ç¤º 302ï¼Œä¸è·Ÿéš¨ | âœ… çœ‹åˆ° Location header |
| `n8n` (é è¨­) | è‡ªå‹•è·Ÿéš¨ redirect | âŒ è¿”å›ç›®æ¨™é é¢çš„ HTML |
| `n8n` (è¨­ç½®å¾Œ) | ä¸è·Ÿéš¨ï¼Œæ¥å— 3xx | âœ… çœ‹åˆ° Location header |

**ç™¼ç”Ÿæµç¨‹**ï¼ˆé è¨­æƒ…æ³ï¼‰ï¼š
```
1. n8n ç™¼é€: POST /api/hedgedoc/new
2. Gateway è¿”å›: 302 Found + Location: /abc123
3. n8n è‡ªå‹•è·Ÿéš¨: GET /api/hedgedoc/abc123
4. HedgeDoc è¿”å›: 200 OK + HTML é é¢
5. n8n é¡¯ç¤º: HTML å…§å®¹ï¼ˆä¸æ˜¯æˆ‘å€‘è¦çš„ï¼‰
```

**æ­£ç¢ºæµç¨‹**ï¼ˆè¨­ç½®å¾Œï¼‰ï¼š
```
1. n8n ç™¼é€: POST /api/hedgedoc/new
2. Gateway è¿”å›: 302 Found + Location: /abc123
3. n8n åœæ­¢ï¼Œä¸è·Ÿéš¨ redirect
4. n8n è¿”å›: 302 + headers.location
5. ç”¨æˆ¶å¯ä»¥æå– Note ID
```

---

## âœ… å®Œæ•´è§£æ±ºæ–¹æ¡ˆ

### æ­¥é©Ÿ 1ï¼šç¢ºèª Gateway å·²æ›´æ–°

**æª¢æŸ¥æ–¹å¼**ï¼šåœ¨çµ‚ç«¯æ©Ÿæ¸¬è©¦
```bash
curl -X POST https://api-gateway.cryptoxlab.workers.dev/api/hedgedoc/new \
  -H "X-API-Key: your_token" \
  -H "Content-Type: text/markdown" \
  -d "# Test" \
  -i
```

**é æœŸçµæœ**ï¼š
```
HTTP/2 302
location: https://api-gateway.cryptoxlab.workers.dev/api/hedgedoc/abc123
```

å¦‚æœçœ‹åˆ°é€™å€‹ï¼ŒGateway å·¥ä½œæ­£å¸¸ âœ…

### æ­¥é©Ÿ 2ï¼šåœ¨ n8n ä¸­è¨­ç½® HTTP Request ç¯€é»

#### 2.1 åŸºæœ¬è¨­ç½®

```
Method: POST
URL: https://api-gateway.cryptoxlab.workers.dev/api/hedgedoc/new
Authentication: None
```

#### 2.2 Headers

```
Name: X-API-Key
Value: {{$env.HEDGEDOC_TOKEN}}

Name: Content-Type
Value: text/markdown
```

#### 2.3 Body

```
Send Body: ON
Body Content Type: Raw/JSON
Body: ï¼ˆä½ çš„ Markdown å…§å®¹ï¼‰
```

#### 2.4 Optionsï¼ˆğŸ”¥ é—œéµè¨­ç½®ï¼‰

**å¿…é ˆè¨­ç½®ä»¥ä¸‹ä¸‰å€‹é¸é …**ï¼š

```
Redirects å€å¡Šï¼š
  â˜ Follow Redirects (é—œé–‰ - ç°è‰²)

Response å€å¡Šï¼š
  â˜‘ Include Response Headers and Status (é–‹å•Ÿ - ç¶ è‰²)
  â˜‘ Never Error (é–‹å•Ÿ - ç¶ è‰²)
```

**ç‚ºä»€éº¼éœ€è¦é€™äº›è¨­ç½®**ï¼š

| è¨­ç½® | ä½œç”¨ | ä¸è¨­ç½®çš„å¾Œæœ |
|------|------|-------------|
| Follow Redirects = OFF | ä¸è‡ªå‹•è·Ÿéš¨ redirect | è¿”å› HTML é é¢ |
| Include Response Headers and Status = ON | è¿”å›å®Œæ•´éŸ¿æ‡‰ï¼ˆåŒ…å« headersï¼‰ | ç„¡æ³•æå– Location |
| Never Error = ON | å…è¨±é 2xx ç‹€æ…‹ç¢¼ | 302 è¢«è¦–ç‚ºéŒ¯èª¤ |

### æ­¥é©Ÿ 3ï¼šæå– Note ID

æ·»åŠ  **Code** ç¯€é»ï¼š

```javascript
// å¾ HTTP Response ä¸­æå– location
const location = $input.item.json.headers.location;

// æå– Note IDï¼ˆURL çš„æœ€å¾Œä¸€æ®µï¼‰
const noteId = location.split('/').pop();

// è¿”å›çµæ§‹åŒ–æ•¸æ“š
return {
  noteId: noteId,
  noteUrl: location,
  directUrl: `https://md.blocktempo.ai/${noteId}`
};
```

**è¼¸å‡º**ï¼š
```json
{
  "noteId": "eq0ug0G2TQifitccs1zJRw",
  "noteUrl": "https://api-gateway.cryptoxlab.workers.dev/api/hedgedoc/eq0ug0G2TQifitccs1zJRw",
  "directUrl": "https://md.blocktempo.ai/eq0ug0G2TQifitccs1zJRw"
}
```

---

## ğŸ“ é‡è¦æ•™è¨“

### æ•™è¨“ 1ï¼šRedirect ä¸æ˜¯ã€ŒéŒ¯èª¤ã€

**éŒ¯èª¤èªçŸ¥**ï¼š
- âŒ 302 redirect æ˜¯éŒ¯èª¤
- âŒ åªæœ‰ 2xx æ‰æ˜¯æˆåŠŸ

**æ­£ç¢ºèªçŸ¥**ï¼š
- âœ… 302 redirect æ˜¯æ­£å¸¸çš„ HTTP éŸ¿æ‡‰
- âœ… å®ƒå‘Šè¨´å®¢æˆ¶ç«¯è³‡æºçš„æ–°ä½ç½®
- âœ… é€™æ˜¯ RESTful API çš„æ¨™æº–æ¨¡å¼ï¼ˆPost-Redirect-Getï¼‰

### æ•™è¨“ 2ï¼šä¸åŒå·¥å…·æœ‰ä¸åŒçš„é è¨­è¡Œç‚º

**curl çš„è¡Œç‚º**ï¼š
- `curl URL`ï¼šè·Ÿéš¨ redirectï¼ˆæœ€å¤š 50 æ¬¡ï¼‰
- `curl -i URL`ï¼šé¡¯ç¤º headersï¼Œä½†ä¸è·Ÿéš¨
- `curl -L URL`ï¼šæ˜ç¢ºè·Ÿéš¨ redirect

**n8n çš„è¡Œç‚º**ï¼š
- é è¨­ï¼šè‡ªå‹•è·Ÿéš¨ redirect
- éœ€è¦æ‰‹å‹•è¨­ç½®ï¼šä¸è·Ÿéš¨ redirect

### æ•™è¨“ 3ï¼šå•é¡Œè¨ºæ–·è¦åˆ†å±¤

æœ¬æ¡ˆä¾‹çš„å•é¡Œåˆ†ç‚ºå…©å±¤ï¼š
1. **æœå‹™ç«¯ï¼ˆGatewayï¼‰**ï¼šéœ€è¦æ­£ç¢ºè™•ç† POST + body + redirect
2. **å®¢æˆ¶ç«¯ï¼ˆn8nï¼‰**ï¼šéœ€è¦æ­£ç¢ºè¨­ç½®ä¸è·Ÿéš¨ redirect

**ä¸èƒ½åªè§£æ±ºä¸€å±¤**ï¼Œå…©å±¤éƒ½è¦æ­£ç¢ºæ‰èƒ½æˆåŠŸã€‚

### æ•™è¨“ 4ï¼šn8n çš„é¸é …åç¨±å¯èƒ½ä¸åŒ

ä¸åŒç‰ˆæœ¬çš„ n8n å¯èƒ½ä½¿ç”¨ä¸åŒçš„é¸é …åç¨±ï¼š

| åŠŸèƒ½ | èˆŠç‰ˆæœ¬ | æ–°ç‰ˆæœ¬ |
|------|--------|--------|
| è¿”å›å®Œæ•´éŸ¿æ‡‰ | Return Full Response | Include Response Headers and Status |
| å…è¨±éŒ¯èª¤ç‹€æ…‹ç¢¼ | Ignore Response Code | Never Error |

**å»ºè­°**ï¼šé–±è®€æ–‡æª”æ™‚ï¼Œç†è§£åŠŸèƒ½è€Œéåªè¨˜åç¨±ã€‚

---

## ğŸ”— ç›¸é—œå•é¡Œè¨˜éŒ„

### æ­·å²å¤±æ•—å˜—è©¦

åœ¨è§£æ±ºé€™å€‹å•é¡Œä¹‹å‰ï¼Œåœ˜éšŠå˜—è©¦äº†å¤šç¨®æ–¹æ³•ï¼š

1. **ä¿®æ”¹ API èª¿ç”¨æ–¹å¼**ï¼ˆå¤±æ•—ï¼‰
   - æ–‡æª”ï¼š[5.2 API Test Results](../05-archive/5.2-api-test-results.md)
   - çµè«–ï¼šå•é¡Œä¸åœ¨ API æ–¹æ³•

2. **èª¿æ•´è«‹æ±‚åƒæ•¸**ï¼ˆå¤±æ•—ï¼‰
   - æ–‡æª”ï¼š[4.1 Failed Attempts](./4.1-failed-attempts.md)
   - çµè«–ï¼šå•é¡Œä¸åœ¨åƒæ•¸è¨­ç½®

3. **æ‡·ç–‘ Gateway å•é¡Œ**ï¼ˆéƒ¨åˆ†æ­£ç¢ºï¼‰
   - ç¢ºå¯¦éœ€è¦ Gateway ä¿®å¾© redirect + body å•é¡Œ
   - ä½†ä¹Ÿéœ€è¦ n8n æ­£ç¢ºè¨­ç½®

### æœ€çµ‚è§£æ±ºæ–¹æ¡ˆ

**å…©å€‹å±¤ç´šçš„ä¿®å¾©**ï¼š
1. âœ… Gateway Workerï¼šä½¿ç”¨ `arrayBuffer()` + `redirect: 'manual'`
2. âœ… n8n è¨­ç½®ï¼šé—œé–‰ "Follow Redirect" + å•Ÿç”¨ "Never Error"

---

## ğŸ“Š å•é¡Œæ™‚é–“ç·š

| æ—¥æœŸ | äº‹ä»¶ | ç‹€æ…‹ |
|------|------|------|
| 2025-11-06 | é¦–æ¬¡å˜—è©¦ n8n èª¿ç”¨ HedgeDoc | âŒ å¤±æ•—ï¼ˆè¿”å› HTMLï¼‰ |
| 2025-11-08 | ç™¼ç¾ Gateway redirect å•é¡Œ | ğŸ” è¨ºæ–·ä¸­ |
| 2025-11-09 | Gateway ä¿®å¾© redirect è™•ç† | âœ… ä¿®å¾©ï¼ˆæœå‹™ç«¯ï¼‰ |
| 2025-11-09 | çµ‚ç«¯æ©Ÿæ¸¬è©¦æˆåŠŸ | âœ… é©—è­‰ Gateway |
| 2025-11-09 | n8n ä»ç„¶å¤±æ•—ï¼ˆè¿”å› HTMLï¼‰ | âŒ æ–°å•é¡Œ |
| 2025-11-09 | é—œé–‰ Follow Redirect | âŒ ä»å¤±æ•—ï¼ˆ302 éŒ¯èª¤ï¼‰ |
| 2025-11-09 | å•Ÿç”¨ Never Error | âœ… å®Œå…¨è§£æ±º |

---

## ğŸ§ª é©—è­‰æ¸…å–®

å®Œæˆè¨­ç½®å¾Œï¼Œè«‹é©—è­‰ï¼š

### âœ… çµ‚ç«¯æ©Ÿæ¸¬è©¦ï¼ˆé©—è­‰ Gatewayï¼‰

```bash
curl -X POST https://api-gateway.cryptoxlab.workers.dev/api/hedgedoc/new \
  -H "X-API-Key: $TOKEN" \
  -H "Content-Type: text/markdown" \
  -d "# Test" \
  -i | grep -E "^HTTP|^location:"
```

**é æœŸè¼¸å‡º**ï¼š
```
HTTP/2 302
location: https://api-gateway.cryptoxlab.workers.dev/api/hedgedoc/...
```

### âœ… n8n æ¸¬è©¦ï¼ˆé©—è­‰è¨­ç½®ï¼‰

åŸ·è¡Œ workflowï¼Œæª¢æŸ¥è¼¸å‡ºï¼š

```json
{
  "headers": {
    "location": "https://api-gateway.cryptoxlab.workers.dev/api/hedgedoc/...",
    ...
  },
  "statusCode": 302,
  "statusMessage": "Found"
}
```

### âŒ éŒ¯èª¤ç¤ºä¾‹

å¦‚æœçœ‹åˆ°ä»¥ä¸‹ä»»ä¸€æƒ…æ³ï¼Œè¨­ç½®ä¸æ­£ç¢ºï¼š

```json
// éŒ¯èª¤ 1ï¼šè¿”å› HTML
{
  "statusCode": 200,
  "data": "<!DOCTYPE html>..."
}

// éŒ¯èª¤ 2ï¼šé¡¯ç¤ºéŒ¯èª¤
{
  "error": "NodeApiError: 302 - Found..."
}
```

---

## ğŸ“š ç›¸é—œæ–‡æª”

- **å¿«é€Ÿåƒè€ƒæŒ‡å—**ï¼š[hedgedoc-gateway-quick-reference.md](../hedgedoc-gateway-quick-reference.md)
- **n8n è¨­ç½®æŒ‡å—**ï¼š[n8n-setup-guide.md](../n8n-setup-guide.md)
- **Gateway æ¸¬è©¦å ±å‘Š**ï¼š[GATEWAY-TEST-REPORT.md](../../GATEWAY-TEST-REPORT.md)
- **Token Manager æŒ‡å—**ï¼š[token-manager-guide.md](../token-manager-guide.md)

---

## ğŸ’¡ çµ¦æœªä¾†é–‹ç™¼è€…çš„å»ºè­°

å¦‚æœä½ é‡åˆ°é¡ä¼¼çš„å•é¡Œï¼š

1. **åˆ†å±¤è¨ºæ–·**
   - å…ˆç”¨ curl æ¸¬è©¦ï¼ˆé©—è­‰æœå‹™ç«¯ï¼‰
   - å†ç”¨ n8n æ¸¬è©¦ï¼ˆé©—è­‰å®¢æˆ¶ç«¯ï¼‰

2. **ç†è§£ HTTP Redirect**
   - 302 ä¸æ˜¯éŒ¯èª¤ï¼Œæ˜¯æ­£å¸¸éŸ¿æ‡‰
   - Location header åŒ…å«é‡è¦è³‡è¨Š

3. **æŸ¥çœ‹å®Œæ•´éŸ¿æ‡‰**
   - å•Ÿç”¨ "Return Full Response" æˆ–é¡ä¼¼é¸é …
   - æª¢æŸ¥ headersã€statusCodeã€body

4. **é–±è®€å·¥å…·æ–‡æª”**
   - n8n çš„é¸é …åç¨±å¯èƒ½æ›´æ–°
   - ç†è§£åŠŸèƒ½ï¼Œè€Œéæ­»è¨˜åç¨±

5. **ä¿ç•™æ¸¬è©¦è¨˜éŒ„**
   - è¨˜éŒ„å¤±æ•—å˜—è©¦å’ŒåŸå› 
   - å¹«åŠ©æœªä¾†çš„å•é¡Œè¨ºæ–·

---

## ğŸ†˜ ä»ç„¶é‡åˆ°å•é¡Œï¼Ÿ

### Debug æ­¥é©Ÿ

1. **æª¢æŸ¥ Gateway æ˜¯å¦æ­£å¸¸**ï¼š
   ```bash
   curl -X POST https://api-gateway.cryptoxlab.workers.dev/api/hedgedoc/new \
     -H "X-API-Key: $TOKEN" \
     -H "Content-Type: text/markdown" \
     -d "# Test" -i
   ```
   æ‡‰è©²çœ‹åˆ° `HTTP/2 302`

2. **æª¢æŸ¥ n8n è¨­ç½®**ï¼š
   - Follow Redirects = OFF âŒ
   - Include Response Headers and Status = ON âœ…
   - Never Error = ON âœ…

3. **æŸ¥çœ‹ n8n åŸå§‹éŸ¿æ‡‰**ï¼š
   - åœ¨ n8n ä¸­å³éµé»æ“Šç¯€é»
   - é¸æ“‡ "Copy input to clipboard"
   - æª¢æŸ¥å®Œæ•´çš„ JSON è¼¸å‡º

4. **æŸ¥çœ‹ç€è¦½å™¨ Developer Console**ï¼š
   - n8n æç¤ºå¯ä»¥æŸ¥çœ‹ç€è¦½å™¨ console
   - æª¢æŸ¥å¯¦éš›ç™¼é€çš„è«‹æ±‚

### è¯ç¹«æ”¯æ´

å¦‚æœå•é¡Œä»æœªè§£æ±ºï¼š
- æŸ¥çœ‹ Token Manager Dashboard çš„ API æ—¥èªŒ
- è¯ç¹« Core Team
- æä¾›å®Œæ•´çš„éŒ¯èª¤è¨Šæ¯å’Œè¨­ç½®æˆªåœ–

---

**æœ€å¾Œæ›´æ–°**ï¼š2025-11-09  
**å•é¡Œç‹€æ…‹**ï¼šâœ… å·²å®Œå…¨è§£æ±º  
**é©—è­‰ç‹€æ…‹**ï¼šâœ… å·²åœ¨ç”Ÿç”¢ç’°å¢ƒé©—è­‰

