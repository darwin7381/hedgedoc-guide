# HedgeDoc n8n 集成問題記錄

> **✅ 問題已解決 (2025-11-09)**
> 
> **完整解決方案**：[4.4 n8n + HedgeDoc Redirect 問題完整解決方案](../04-troubleshooting/4.4-n8n-hedgedoc-redirect-issue.md)
> 
> **關鍵發現**：
> 1. ✅ Gateway Worker 已修復 redirect + body 處理
> 2. ✅ n8n 需要正確設置 Options：
>    - 關閉 "Follow Redirects"
>    - 啟用 "Never Error"
>    - 啟用 "Include Response Headers and Status"
> 3. ✅ 問題根源是 HTTP redirect 的處理方式，不是 n8n 無法調用

---

## 問題（歷史記錄）
n8n HTTP Request 節點無法成功調用 HedgeDoc `/new` API，但終端機 curl 可以。

## 測試環境
- **HedgeDoc**: https://hedgedoc-production-bab4.up.railway.app/
- **版本**: 1.10.3

---

## ✅ curl 成功測試

```bash
curl -X POST https://hedgedoc-production-bab4.up.railway.app/new \
  -H "Content-Type: text/markdown" \
  -d "# 測試標題

測試內容..." \
  -i
```

**結果**: 
- 狀態碼: 302 ✅
- 新筆記: https://hedgedoc-production-bab4.up.railway.app/IYM8kTGjQrGddfxy7sIOyw

---

## ❌ n8n 失敗方法

所有 n8n HTTP Request 節點配置都失敗：

### 1. Raw 模式 (text/markdown)
```
Method: POST
Headers: Content-Type: text/markdown
Body Content Type: Raw
Content Type: text/markdown
Body: markdown 內容
```
**結果**: 200 + HTML 頁面 ❌

### 2. JSON 模式 (application/json)
```
Method: POST
Headers: Content-Type: application/json
Body Content Type: JSON
Body: "# 標題\n\n內容..."
```
**結果**: 200 + HTML 頁面 ❌

### 3. Form-Data 模式
```
Method: POST
Headers: Content-Type: application/x-www-form-urlencoded
Body Content Type: Form-Data
Parameters:
  Name: (空白)
  Value: markdown 內容
```
**結果**: 200 + HTML 頁面 ❌

### 4. Raw 模式 (無 Content-Type)
```
Method: POST
Body Content Type: Raw
Body: markdown 內容
```
**結果**: 200 + HTML 頁面 ❌

### 5. 完全模擬 curl Headers
```
Method: POST
Headers: 
  Content-Type: text/markdown
  User-Agent: curl/7.68.0
  Accept: */*
Body Content Type: Raw
Body: markdown 內容
```
**結果**: 200 + HTML 頁面 ❌

### 6. n8n Binary File 模式
```
Method: POST
Body Content Type: n8n Binary File
Parameter Type: n8n Binary File
Input Data Field Name: data
```
**結果**: 錯誤 - "This operation expects the node's input data to contain a binary file 'data'" ❌

### 7. Form-Data with file parameter
```
Method: POST
Body Content Type: Form-Data
Parameters:
  Name: file
  Value: markdown 內容
```
**結果**: 200 + HTML 頁面 ❌

### 8. Custom Content-Type 組合測試
```
Content-Type: text/plain
Content-Type: application/octet-stream
Content-Type: multipart/form-data
```
**結果**: 全部失敗 ❌

---

## ❌ 已證偽的錯誤解決方案

### Execute Command 節點 (不存在)
~~使用 Execute Command 節點執行 curl~~
**問題**: n8n 根本沒有 Execute Command 節點 ❌

### Code 節點執行系統命令 (不可行)
~~在 Code 節點中使用 execSync 執行 curl~~
**問題**: n8n Code 節點安全限制，無法執行系統命令 ❌

---

## 結論

**核心問題**: n8n HTTP Request 節點無法正確發送與 curl 相同的請求  
**解決方案**: 目前沒有找到任何可行方案  
**狀態**: ❌ 完全無解，n8n 無法調用 HedgeDoc API

---

## 更新記錄
- **2025-06-25**: curl 測試成功，確認 n8n HTTP Request 節點問題 